var $jscomp={scope:{},checkStringArgs:function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable: true,writable: true,value:b})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var d=b.length,f=a.length,g=Math.max(0,Math.min(c|0,b.length)),l=0;l<f&&g<d;)if(b[g++]!=a[l++])return false;return l>=f}},"es6-impl","es3");
function qgrillas_ArmarObjetoFilaFila(a){var b=gGrillas[a].Tabla,c=qcom_Clonar(gClones[b]);qcom_InicializarColumnasSegmentoFila(b,c);c.IDCol=parseInt(gGrillas[a].ValorPK);var e=$("#"+a).data("igGrid").dataSource,d=-1!=gGrillas[a].ColIdEnEdicion;""!=gGrillas[a].CampoAutonumerico&&(c[gGrillas[a].CampoAutonumerico]=parseInt(gGrillas[a].ValorPK));for(var f=$("#"+a).igGrid("option","columns"),g=0;g<f.length;g++)null!=gControles[b][0][f[g].key]?c[f[g].key]=qcom_ObtenerValorControl(gControles[b][0][f[g].key]):
d&&(c[f[g].key]=e._dataView[gGrillas[a].ColIdEnEdicion][f[g].key]);qcom_CargoOcultosSegmentoFila(b,c);return c}
function qgrillas_FinAceptarFila(a){if(-1!=gGrillas[a].ColIdEnEdicion){if($(window).width()>=gSizePhone){var b=$('input[name="opt'+a+'"]:checked');lValRet="";var c= false;0<b.length&&(lValRet=b[0].value);var b=$("#"+a).data("igGrid").dataSource,e=$("#"+a).igGridSelection("selectedCell");lPagina=0;lCantXPag=2E3;for(var d=$("#"+a).igGrid("option","features"),f= false,g=0;g<d.length&&!f;g++)f="Paging"==d[g].name;f&&(lPagina=$("#"+a).igGridPaging("option","currentPageIndex"),lCantXPag=$("#"+a).igGridPaging("option",
"pageSize"));""==lValRet||"X"==lValRet?c= true:"S"==lValRet&&lPagina*lCantXPag+e.rowIndex>=b._data.length-1?c= true:"A"==lValRet&&0==e.rowIndex&&0==lPagina&&(c= true);c?($("#divGrupo"+a).attr("Abierto","false"),$("#divGrupo"+a).modal("hide"),void 0!=$("#"+a)&&null!=$("#"+a)&&$("#"+a).focus(),void 0!=$("#"+a).igGridSelection("selectedCell")&&null!=$("#"+a).igGridSelection("selectedCell")&&void 0!=$("#"+a).igGridSelection("selectedCell").element[0]&&null!=$("#"+a).igGridSelection("selectedCell").element[0]&&
$("#"+a).igGridSelection("selectedCell").element[0].focus()):("S"==lValRet?e.rowIndex<b._dataView.length-1?$("#"+a).igGridSelection("selectCell",e.rowIndex+1,e.index):($("#"+a).igGridPaging("pageIndex",lPagina+1),$("#"+a).igGridSelection("selectCell",0,e.index)):"A"==lValRet&&(0<e.rowIndex?$("#"+a).igGridSelection("selectCell",e.rowIndex-1,e.index):($("#"+a).igGridPaging("pageIndex",lPagina-1),$("#"+a).igGridSelection("selectCell",lCantXPag-1,e.index))),c=$("#"+a).igGridSelection("selectedCell"),
qgrillas_SeleccionarCelda(a,c.rowIndex,c.id,gGrillas[a].ColumnaEnEdicion, false),c=qgrillas_ControlFoco(a),null!=c&&c.focus(),qevt_Grilla_EditarFila(a,0))}else $("#divGrupo"+a).attr("Abierto","false"),$("#divGrupo"+a).modal("hide"),$("#"+a).igGrid("dataBind");qevt_EjecutarSiguiente()}else qevt_Grilla_NuevaFila(a, false),qevt_EjecutarSiguiente(),c=qgrillas_ControlFoco(a),null!=c&&c.focus()}
function qgrillas_CancelarFila(a){qcom_HabilitoGuardar();var b=gGrillas[a].Tabla;qevt_VaciarEventosTmp();$.each(gRelacTablas,function(a,e){e.getTablaMaster()==b&&"G"==e.getTipoCtrlDetalle()&&(lNombreTablaDetail=e.getTablaDetalle(),lNombreGrillaDetail="grd"+e.getTablaDetalle(),void 0!=gGrillas[lNombreGrillaDetail]&&(lCampoFK=e.getColDetalle(),lCampoPK=e.getColMaster(),gEntidadAux[lNombreTablaDetail].splice(0),gGrillas[lNombreGrillaDetail].FilasFiltradas=[]))});-1!=gGrillas[a].ColIdEnEdicion?$(window).width()>=
gSizePhone?($("#divGrupo"+a).modal("hide"),$("#"+a).focus(),$("#"+a).igGridSelection("selectedCell").element[0].focus()):($("#divGrupo"+a).modal("hide"),$("#"+a).igGrid("dataBind")):($("#divGrupo"+a).modal("hide"),$("#"+a).focus())}
function qgrillas_blanquearControles(a,b){gGrillas[a].ColIdEnEdicion=-1;gGrillas[a].ColumnaEnEdicion="";var c=gGrillas[a].Tabla;gGrillas[a].ValorPK=qgrillas_ObtenerNuevaPK(a);$.each(gControles[c][0],function(a,d){null!=gControles[c][0][a]&&((b||gControles[c][0][a].getNuevoBlanquea())&&qcom_AsignarValorControl(gControles[c][0][a],gControles[c][0][a].getDefecto(), true),""!=d.getControlConjunto()&&(d.getHabilitado()&&d.getHabilitadoxSeteo()?qcom_HabilitarControl(d.getControlConjunto()):qcom_DesHabilitarControl(d.getControlConjunto()),
d.getVisible()&&d.getVisibleXPais()&&d.getVisiblexSeteo()?qcom_MostrarControl(d.getControlConjunto()):qcom_OcultarControl(d.getControlConjunto())))});$.each(gRelacTablas,function(b,d){"G"==d.getTipoCtrlDetalle()&&(d.getTablaMaster()==c?d.getTipoCtrlDetalle()&&(lCampoPK=d.getColMaster(),lValorFiltro="",gGrillas[a].CampoAutonumerico==lCampoPK?(lValorFiltro=parseInt(gGrillas[a].ValorPK),gRelacTablas[b].setValorMaster(parseInt(gGrillas[a].ValorPK))):(lValorFiltro="0",gRelacTablas[b].setValorMaster("0")),
lNombreTablaDetail=d.getTablaDetalle(),lNombreGrillaDetail="grd"+d.getTablaDetalle(),void 0!=gGrillas[lNombreGrillaDetail]&&(0<gGrillas[lNombreGrillaDetail].RegistrosPorPagina&&gGrillas[lNombreGrillaDetail].Control.igGridFiltering("filter",[]),lCampoFK=d.getColDetalle(),gEntidadAux[lNombreTablaDetail].splice(0),gGrillas[lNombreGrillaDetail].FilasFiltradas=[],gGrillas[lNombreGrillaDetail].Control.igGrid("option","dataSource",gEntidadAux[lNombreTablaDetail]),gGrillas[lNombreGrillaDetail].Control.igGrid("dataBind"))):
d.getTablaDetalle()==c&&(lCampoFK=d.getColDetalle(),null!=gControles[c][0][lCampoFK]&&qcom_AsignarValorControl(gControles[c][0][lCampoFK],d.getValorMaster(), true)))});qevt_EjecutarSiguiente()}function qgrillas_ObtenerNuevaPK(a){gGrillas[a].UltimaPK+=1;return gGrillas[a].UltimaPK}
function qgrillas_guardarDatosEdicion(a){var b={},c=gGrillas[a].Tabla,b=qgrillas_ArmarObjetoFilaFila(a),e= false;$.each(gRelacTablas,function(a,f){"G"==f.getTipoCtrlDetalle()&&f.getTablaDetalle()==c&&(e= true,lCampoFK=f.getColDetalle(),void 0==b[lCampoFK]||null==b[lCampoFK])&&(b[lCampoFK]=f.getValorMaster())});-1==gGrillas[a].ColIdEnEdicion?$("#"+a).igGridUpdating("addRow",b):$("#"+a).igGridUpdating("updateRow",gGrillas[a].ValorPK,b);e||(gTieneSinGuardar= true);$.each(gRelacTablas,function(a,b){if("G"==b.getTipoCtrlDetalle()&&
b.getTablaMaster()==c&&(lNombreTablaDetail=b.getTablaDetalle(),lNombreGrillaDetail="grd"+b.getTablaDetalle(),void 0!=gGrillas[lNombreGrillaDetail])){for(var e=gGrillas[lNombreGrillaDetail].FilasFiltradas.length-1;0<=e;e--)gEntidad[lNombreTablaDetail].splice(gGrillas[lNombreGrillaDetail].FilasFiltradas[e],1);$.each(gEntidadAux[lNombreTablaDetail],function(a,b){gEntidad[lNombreTablaDetail].push(jQuery.extend({},b))})}});qevt_EjecutarSiguiente()}
function qgrillas_SeleccionarCelda(a,b,c,e,d){$(window).width()>=gSizePhone?(gGrillas[a].ColIdEnEdicion=b,gGrillas[a].ValorPK=c,gGrillas[a].ColumnaEnEdicion=e):qgrillas_obtenerValorRowIndexPhone(a,c)}
function qgrillas_llenarDatosEdicionGeneral(a){var b=gGrillas[a].Tabla,c=$("#"+a).data("igGrid").dataSource;$.each(gControles[b][0],function(e,d){null!=gControles[b][0][e]&&(qcom_AsignarValorControl(gControles[b][0][e],c._dataView[gGrillas[a].ColIdEnEdicion][e], false),""!=d.getControlConjunto()&&(d.getHabilitado()&&d.getHabilitadoxSeteo()?qcom_HabilitarControl(d.getControlConjunto()):qcom_DesHabilitarControl(d.getControlConjunto()),d.getVisible()&&d.getVisibleXPais()&&d.getVisiblexSeteo()?qcom_MostrarControl(d.getControlConjunto()):
qcom_OcultarControl(d.getControlConjunto())))});$.each(gRelacTablas,function(e,d){"G"==d.getTipoCtrlDetalle()&&(d.getTablaMaster()==b?(void 0!=gGrillas["grd"+b]&&gEntidadAux[b].splice(0),lCampoPK=d.getColMaster(),lValorFiltro=c._dataView[gGrillas[a].ColIdEnEdicion][lCampoPK],gRelacTablas[e].setValorMaster(lValorFiltro),lNombreTablaDetail=d.getTablaDetalle(),lNombreGrillaDetail="grd"+d.getTablaDetalle(),void 0!=gGrillas[lNombreGrillaDetail]&&(0<gGrillas[lNombreGrillaDetail].RegistrosPorPagina&&gGrillas[lNombreGrillaDetail].Control.igGridFiltering("filter",
[]),lCampoFK=d.getColDetalle(),gEntidadAux[lNombreTablaDetail].splice(0),gGrillas[lNombreGrillaDetail].FilasFiltradas=[],$.each(gEntidad[lNombreTablaDetail],function(a,b){b[lCampoFK]==lValorFiltro&&(gGrillas[lNombreGrillaDetail].FilasFiltradas.push(a),gEntidadAux[lNombreTablaDetail].push(jQuery.extend({},b)))}),gGrillas[lNombreGrillaDetail].Control.igGrid("option","dataSource",gEntidadAux[lNombreTablaDetail]),gGrillas[lNombreGrillaDetail].Control.igGrid("dataBind"))):d.getTablaDetalle()==b&&(lCampoFK=
d.getColDetalle(),null!=gControles[b][0][lCampoFK]&&qcom_AsignarValorControl(gControles[b][0][lCampoFK],d.getValorMaster(), true)))});qevt_EjecutarSiguiente()}function qgrillas_llenarDatosEdicion(a){qgrillas_llenarDatosEdicionGeneral(a)}function qgrillas_llenarDatosEdicionPhone(a,b){qgrillas_llenarDatosEdicionGeneral(a)}
function qgrillas_obtenerValorRowIndexPhone(a,b){for(var c=$("#"+a).data("igGrid").dataSource,e=0;e<c._dataView.length;e++)c._dataView[e].IDCol==b&&(gGrillas[a].ColIdEnEdicion=e,gGrillas[a].ValorPK=b,gGrillas[a].ColumnaEnEdicion="")}function qgrillas_Borrar(a,b){$(a).igGridUpdating("deleteRow",b);$(a).igGrid("dataBind");qevt_EjecutarSiguiente()}
function qgrillas_EditarFilaEnGrilla(a,b){$(a).igGridUpdating("option","editMode");$(a).igGridUpdating("option","editMode","dialog");$(a).igGridUpdating("startEdit",b,b, true);qevt_EjecutarSiguiente()}
function qgrillas_ControlFoco(a){for(var b=$("#"+a).igGrid("option","columns"),c= false,e=null,d=0;d<b.length&&!c;d++){var f=gGrillas[a].Tabla;null!=gControles[f][0][b[d].key]&&gControles[f][0][b[d].key].getControl().is(":visible")&&!gControles[f][0][b[d].key].getControl().is(":disabled")&&(e=gControles[f][0][b[d].key].getControl(),c= true)}return e}
function qgrillas_validarDatosFila(a){var b= true;qcom_HabilitoGuardar();if(""!=gGrillas[a].CamposPK)for(var c=$("#"+a).data("igGrid").dataSource,e=gGrillas[a].CamposPK.split("|"),d=gGrillas[a].Tabla,f=0;f<c._data.length&&b;f++)if(-1==gGrillas[a].ColIdEnEdicion||gGrillas[a].ValorPK!=c._data[f].IDCol){for(var g= true,l=0;l<e.length&&g;l++)null!=gControles[d][0][e[l]]&&qcom_ObtenerValorControl(gControles[d][0][e[l]])!=c._data[f][e[l]]&&(g= false);g&&(qevt_VaciarEventosTmp(),b= false,qcom_Alerta(qrecItemYaIngresado,
"danger",null))}b&&qevt_EjecutarSiguiente()}function qgrillas_EjecutarSobreFilaSelec(a,b,c,e,d,f){qgrillas_EjecutarSobreFilaSelecGral(a,b,c,e,d,f, false)}function qgrillas_EjecutarSobreFilaColSelec(a,b,c,e,d,f){qgrillas_EjecutarSobreFilaSelecGral(a,b,c,e,d,f, true)}
function qgrillas_EjecutarSobreFilaSelecGral(a,b,c,e,d,f,g){var l="",h=-1,m="";""!=b&&void 0!=gGrillas[b]&&(l=gGrillas[b].Tabla);if(""!=l){if(gGrillas[b].EsArbol)for(var m=gEntidad[l].length,n=gGrillas[b].CamposPK,p=0;p<m&&-1==h;p++)gEntidad[l][p][n]==gGrillas[b].ValorPK&&(h=p);else for(m=gEntidad[l].length,p=0;p<m&&-1==h;p++)gEntidad[l][p].IDCol==gGrillas[b].ValorPK&&(h=p);m=gGrillas[b].ColumnaEnEdicion}-1>=h?(qevt_VaciarEventosTmp(),qcom_Alerta(qrecSinFilaSelec,"danger",null)):(b=""!=c,$("#divCargando").addClass("show"),
l=sessionStorage.getItem("idses"),d=qcom_CargarTablasAEnviar(d,gEntidad),g=g?"AjaxHandler/AcGrillas.ashx?pTipoAccion=SCol":"AjaxHandler/AcGrillas.ashx?pTipoAccion=S",a={pDsEntidad:d,pIndice:h,pDllEventos:gFormulario.getDLLEventos(),pClaseEventos:gFormulario.getClaseEventos(),pDllCommon:gFormulario.getDLLCommon(),pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),
pTieneDSEsp:gTieneDsEsp,pEsEspecializada:f,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,pNombreAccion:a,pTablasPlanas:gTablasPlanas.join("|"),pFormulario:gConfiguracion.getFormulario(),pIdSes:l,pEsDownload:b,pColumna:m},$.ajax({type:"POST",url:gConfiguracion.getSitio()+g,data:a,dataType:"json"}).done(function(a){$("#divCargando").removeClass("show");if(void 0==a.e)if(""==c)qcom_HabilitarGuardar(),gEntidad=qcom_CargarTablasARefrescar(e,a,gEntidad),e=""==e?"":"|"+e+"|",qcom_TablasPlanasaControles(e),
$.each(gGrillasAux,function(a,b){var c=gGrillas[b].Tabla;if(""==e||-1!==e.indexOf("|"+c+"|"))gGrillas[b].AutoFormateable?qgrillas_CrearGrilla(gGrillas[b].NombreControl,gEntidad[c],gEntidad[c+"fmt"]):(gGrillas[b].UltimaPK=""==gGrillas[b].CampoAutonumerico||0==gEntidad[c].length?gEntidad[c].length:gEntidad[c][gEntidad[c].length-1][gGrillas[b].CampoAutonumerico],gGrillas[b].EsArbol?(gGrillas[b].Control.igTreeGrid("option","dataSource",gEntidad[c]),gGrillas[b].Control.igTreeGrid("dataBind")):(gGrillas[b].Control.igGrid("option",
"dataSource",gEntidad[c]),gGrillas[b].Control.igGrid("dataBind")))}),$.each(gListasAdjuntosAux,function(a,b){var c=gListasAdjuntos[b].Tabla;if(""==e||-1!==e.indexOf("|"+c+"|")){var d=gListasAdjuntos[b].NombreControl;qlstadj_VaciarLista(d);for(var f=0;f<gEntidad[c].length;f++)gEntidad[c][f].Estado!=gEstadoAdjunto.Borrado&&qlstadj_AgregarVistaAdjunto(d, false,f,f);gListasAdjuntos[b].UltId=gEntidad[c].length}}),qevt_EjecutarSiguiente();else if("D"==c){var b=qcom_ObtenerTipoContDownLoad(a.Principal[0].EsURL,
a.Principal[0].Extension),d=window.document.createElement("a");d.id="reftemporal";d.innerText=a.Principal[0].Titulo;d.href=b+a.Principal[0].Archivo;d.download=a.Principal[0].NombreArchivoDescargado;document.body.appendChild(d);qcom_DescargarArchivo("temporal", false);document.body.removeChild(d);qevt_EjecutarSiguiente()}else"P"==c&&(window.open("").document.write("<iframe width='100%' height='100%' src='data:application/pdf;base64, "+encodeURI(a.Principal[0].Archivo)+"'></iframe>"),qevt_EjecutarSiguiente());
else qcom_TratarError(a.e)}).fail(function(a,b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_Alerta(c,"danger",null)}))}
function qgrillas_EjecutarSobreFilaSelecMasiva(a,b,c,e,d){var f="",g=-1,l=null;""!=b&&void 0!=gGrillas[b]&&(f=gGrillas[b].Tabla);if(""!=f){l=qcom_Clonar(gEntidadAyuda);$.each(gEntidad,function(a,b){a!=f&&(l[a]=qcom_Clonar(gEntidad[a]))});l[f].splice(0,l[f].length);var h=$("#"+b).igGridSelection("selectedCell");void 0!=h&&(b=$("#"+b).data("igGrid").dataSource,l[f].push(jQuery.extend({},b._dataView[h.rowIndex])),g=0)}-1>=g?(qevt_VaciarEventosTmp(),qcom_Alerta(qrecSinFilaSelec,"danger",null)):($("#divCargando").addClass("show"),
h=sessionStorage.getItem("idses"),a={pDsEntidad:qcom_CargarTablasAEnviar(e,l),pIndice:0,pDllEventos:gFormulario.getDLLEventos(),pClaseEventos:gFormulario.getClaseEventos(),pDllCommon:gFormulario.getDLLCommon(),pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),pTieneDSEsp:gTieneDsEsp,pEsEspecializada:d,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,
pNombreAccion:a,pTablasPlanas:gTablasPlanas.join("|"),pFormulario:gConfiguracion.getFormulario(),pIdSes:h,pEsDownload: false},$.ajax({type:"POST",url:gConfiguracion.getSitio()+"AjaxHandler/AcGrillas.ashx?pTipoAccion=S",data:a,dataType:"json"}).done(function(a){$("#divCargando").removeClass("show");void 0==a.e?(qcom_HabilitarGuardar(),l=a,c=""==c?"":"|"+c+"|",$.each(l,function(a,b){a==f||""!=c&&-1===c.indexOf("|"+f+"|")||(gEntidad[a]=qcom_Clonar(l[a]))}),qcom_TablasPlanasaControles(c),$.each(gGrillasAux,
function(a,b){var d=gGrillas[b].Tabla;d==f||""!=c&&-1===c.indexOf("|"+f+"|")||(gGrillas[b].AutoFormateable?qgrillas_CrearGrilla(gGrillas[b].NombreControl,gEntidad[d],gEntidad[d+"fmt"]):(gGrillas[b].UltimaPK=""==gGrillas[b].CampoAutonumerico||0==gEntidad[d].length?gEntidad[d].length:gEntidad[d][gEntidad[d].length-1][gGrillas[b].CampoAutonumerico],gGrillas[b].Control.igGrid("option","dataSource",gEntidad[d]),gGrillas[b].Control.igGrid("dataBind")))}),qevt_EjecutarSiguiente()):qcom_TratarError(a.e)}).fail(function(a,
b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_Alerta(c,"danger",null)}))}
function qgrillas_EjecutarSobreFilaSelecMasivaConAct(a,b,c,e,d,f){var g="",l=-1,h=null,m=-1,n=-1;""!=b&&void 0!=gGrillas[b]&&(g=gGrillas[b].Tabla);if(""!=g){h=qcom_Clonar(gEntidadAyuda);$.each(gEntidad,function(a,b){a!=g&&(h[a]=qcom_Clonar(gEntidad[a]))});h[g].splice(0,h[g].length);var p=$("#"+b).data("igGrid").dataSource;if(f){f= false;for(var q=0;!f&&q<p._dataView.length;q++)p._dataView[q].IDCol==gGrillas[b].IDFinEdicion&&(n=gGrillas[b].IDFinEdicion,l=m=q,h[g].push(jQuery.extend({},p._dataView[q])),
f= true)}else f=$("#"+b).igGridSelection("selectedCell"),void 0!=f&&(h[g].push(jQuery.extend({},p._dataView[f.rowIndex])),n=p._dataView[f.rowIndex].IDCol,m=f.rowIndex,l=0)}gGrillas[b].IDFinEdicion=-1;-1>=l?(qevt_VaciarEventosTmp(),qcom_Alerta(qrecSinFilaSelec,"danger",null)):($("#divCargando").addClass("show"),l=sessionStorage.getItem("idses"),a={pDsEntidad:qcom_CargarTablasAEnviar(e,h),pIndice:0,pDllEventos:gFormulario.getDLLEventos(),pClaseEventos:gFormulario.getClaseEventos(),pDllCommon:gFormulario.getDLLCommon(),
pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),pTieneDSEsp:gTieneDsEsp,pEsEspecializada:d,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,pNombreAccion:a,pTablasPlanas:gTablasPlanas.join("|"),pFormulario:gConfiguracion.getFormulario(),pIdSes:l,pEsDownload: false},$.ajax({type:"POST",url:gConfiguracion.getSitio()+"AjaxHandler/AcGrillas.ashx?pTipoAccion=S",
data:a,dataType:"json"}).done(function(a){$("#divCargando").removeClass("show");void 0==a.e?(qcom_HabilitarGuardar(),h=a,c=""==c?"":"|"+c+"|",$.each(h,function(a,b){a==g||""!=c&&-1===c.indexOf("|"+g+"|")||(gEntidad[a]=qcom_Clonar(h[a]))}),qcom_TablasPlanasaControles(c),$.each(gGrillasAux,function(a,d){var e=gGrillas[d].Tabla;if(e!=g&&(""==c||-1!==c.indexOf("|"+g+"|")))gGrillas[d].AutoFormateable?qgrillas_CrearGrilla(gGrillas[d].NombreControl,gEntidad[e],gEntidad[e+"fmt"]):(gGrillas[d].UltimaPK=""==
gGrillas[d].CampoAutonumerico||0==gEntidad[e].length?gEntidad[e].length:gEntidad[e][gEntidad[e].length-1][gGrillas[d].CampoAutonumerico],gGrillas[d].Control.igGrid("option","dataSource",gEntidad[e]),gGrillas[d].Control.igGrid("dataBind"));else if(e==g){h[g][0].IDCol=n;var e=qcom_Clonar(gClones[g]),f=$("#"+b).igGrid("option","columns");if($("#"+b).igGridUpdating("isEditing")){for(var k=gGrillas[b].FilaFoco,l=gGrillas[b].ColumnaFoco,r=0;r<f.length;r++)void 0!=h[g][0][f[r].key]&&(e[f[r].key]=h[g][0][f[r].key],
p._dataView[m][f[r].key]=h[g][0][f[r].key],$("#"+b).igGridUpdating("setCellValue",n,f[r].key,h[g][0][f[r].key]));-1!=k&&-1!=l&&($("#"+b).igGridUpdating("endEdit", false),$("#"+b).igGridUpdating("startEdit",k,l))}else{for(r=0;r<f.length;r++)e[f[r].key]=void 0!=h[g][0][f[r].key]?h[g][0][f[r].key]:p._dataView[m][f[r].key];$("#"+b).igGridUpdating("updateRow",n,e)}}}),qevt_EjecutarSiguiente()):qcom_TratarError(a.e)}).fail(function(a,b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_Alerta(c,
"danger",null)}))}function qgrillas_EjecutarCondicionEnGrilla(a,b,c,e,d){qgrillas_EjecutarAcccionGralEnGrilla(a,b,c,"C","",e,d,"")}function qgrillas_MostrarReporteConParamDesdeServer(a,b,c,e,d,f){qgrillas_EjecutarAcccionGralEnGrilla(a,b,c,"R","",e,d,f)}function qgrillas_EjecutarAccionEnGrilla(a,b,c,e,d,f){e?qgrillas_EjecutarAcccionGralEnGrilla(a,b,c,"F","",d,f,""):qgrillas_EjecutarAcccionGralEnGrilla(a,b,c,"A","",d,f,"")}
function qgrillas_EjecutarValidarFilaGrilla(a,b,c,e,d){qgrillas_EjecutarAcccionGralEnGrilla(a,b,c,"V","",e,d,"")}function qgrillas_EjecutarValidarInicioEdicion(a,b,c,e,d){qgrillas_EjecutarAcccionGralEnGrilla(a,b,c,"IEF","",e,d,"")}function qgrillas_ObtenerVariables(a,b,c,e,d){qgrillas_EjecutarAcccionGralEnGrilla(a,b,c,"O","",e,d,"")}
function qgrillas_EjecutarAcccionGralEnGrilla(a,b,c,e,d,f,g,l){d="undefined"!==typeof d?d:"";$("#divCargando").addClass("show");var h="";""!=b&&void 0!=gGrillas[b]&&(h=gGrillas[b].Tabla);var m="",n= false,p= false,q=qcom_CargarTablasAEnviar(f,gEntidad),k=null,r=-1;if(""!=b&&void 0!=gGrillas[b]){$.each(gRelacTablas,function(a,b){if(b.getTablaMaster()==h)return n= true, false;if(b.getTablaDetalle()==h)return p= true,m=b.getTablaMaster(), false});var w=qgrillas_ArmarObjetoFilaFila(b);if(n||!n&&!p){gEntidadAux[h].splice(0);
gEntidadAux[h].push(w);for(var u=gEntidad[h].length,v=0;v<u&&-1==r;v++)gEntidad[h][v].IDCol==gGrillas[b].ValorPK&&(r=v)}else if(p){gEntidadAux[m].splice(0);k=qcom_Clonar(gEntidadAux);u=qgrillas_ArmarObjetoFilaFila("grd"+m);k[m].push(u);u=k[h].length;for(v=0;v<u&&-1==r;v++)k[h][v].IDCol==gGrillas[b].ValorPK&&(r=v);-1==r?k[h].push(w):k[h][r]=w}}var t=null==k?JSON.stringify(gEntidadAux):JSON.stringify(k),w=sessionStorage.getItem("idses"),k="";switch(e){case "V":k="AjaxHandler/AcGrillas.ashx?pTipoAccion="+
e;break;case "C":k="AjaxHandler/AcGrillas.ashx?pTipoAccion="+e;break;case "R":k="AjaxHandler/ParamReporte.ashx?pTipo=F";break;case "A":k="AjaxHandler/AcGrillas.ashx?pTipoAccion="+e;break;case "F":k="AjaxHandler/AcGrillas.ashx?pTipoAccion=A";break;case "O":k="AjaxHandler/ObtenerVariablesFE.ashx";break;case "IEF":k="AjaxHandler/AcGrillas.ashx?pTipoAccion="+e}d={pDsEntidad:q,pDsEntidadAux:t,pIndice:r,pDllEventos:gFormulario.getDLLEventos(),pClaseEventos:gFormulario.getClaseEventos(),pDllCommon:gFormulario.getDLLCommon(),
pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),pTieneDSEsp:gTieneDsEsp,pEsEspecializada:g,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,pNombreAccion:a,pFormulario:gConfiguracion.getFormulario(),pIdSes:w,pCodigoConsulta:d};$.ajax({type:"POST",url:gConfiguracion.getSitio()+k,data:d,dataType:"json"}).done(function(d){$("#divCargando").removeClass("show");
var k=void 0!=d.e;if(k&&d.e.startsWith("cons:"))qgrillas_EjecutarAcccionGralEnGrilla_Mens(a,b,c,e,d,f,g,l);else if(k)qcom_existeControl("#divMensajeItera")&&$("#divMensajeItera").removeClass("show"),qcom_TratarError(d.e);else switch(e){case "V":d=d.d;""!=d?(qevt_VaciarEventosTmp(),qcom_Alerta(d,"info",null)):qevt_EjecutarSiguiente();break;case "C":d=d.d;qevt_EliminarNodosCond(d);qevt_EjecutarSiguiente();break;case "R":var k=d.d,q=d.m;d=d.t;""==k&&(k=qcom_ObtenerParametrosReporte());""==q&&(q=l);qcom_MostrarReporte(q,
k,d,"");qevt_EjecutarSiguiente();break;case "A":t=d;-1==r&&(r=0<t[h].length?t[h].length-1:0);$.each(gControles[h][0],function(a,b){null!=gControles[h][0][a]&&(n||!p?qcom_AsignarValorControl(gControles[h][0][a],t[h][0][a], false):qcom_AsignarValorControl(gControles[h][0][a],t[h][r][a], false))});n&&$.each(gRelacTablas,function(a,b){if(b.getTablaMaster()==h){var c=b.getTablaDetalle();gEntidadAux[c].splice(0);if("G"==b.getTipoCtrlDetalle()){var d="grd"+c;$.each(t[c],function(a,b){t[c][a].IDCol=qgrillas_ObtenerNuevaPK(d);
gEntidadAux[c].push(jQuery.extend({},t[c][a]))});gGrillas[d].Control.igGrid("option","dataSource",gEntidadAux[c]);gGrillas[d].Control.igGrid("dataBind")}else if("A"==b.getTipoCtrlDetalle()){var e="lstadj"+c;qlstadj_VaciarLista(e);for(var f=0;f<t[c].length;f++)t[c][f].Estado!=gEstadoAdjunto.Borrado&&(gEntidadAux[c].push(jQuery.extend({},t[c][f])),qlstadj_AgregarVistaAdjunto(e, true,f,f));gListasAdjuntos.UltId=t[c].length}}});qevt_EjecutarSiguiente();break;case "F":t=d;r=0;$.each(gControles[m][0],function(a,
b){null!=gControles[m][0][a]&&qcom_AsignarValorControl(gControles[m][0][a],t[m][r][a], false)});p&&$.each(gRelacTablas,function(a,b){if("G"==b.getTipoCtrlDetalle()&&b.getTablaMaster()==m&&b.getTablaDetalle()!=h){var c=b.getTablaDetalle(),d="grd"+c;gEntidadAux[c].splice(0);$.each(t[c],function(a,b){t[c][a].IDCol=qgrillas_ObtenerNuevaPK(d);gEntidadAux[c].push(jQuery.extend({},t[c][a]))});gGrillas[d].Control.igGrid("option","dataSource",gEntidadAux[c]);gGrillas[d].Control.igGrid("dataBind")}});qevt_EjecutarSiguiente();
break;case "O":d=JSON.parse(d.d);$.each(d,function(a,b){gVariables[b.Id]=b.Valor});qevt_EjecutarSiguiente();break;case "IEF":d=d.d;""!=d?qevt_VaciarEventosTmp():qevt_EjecutarSiguiente();break;default:qevt_EjecutarSiguiente()}}).fail(function(a,b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_existeControl("#divMensajeItera")&&$("#divMensajeItera").removeClass("show");qcom_Alerta(c,"danger",null)})}
function qgrillas_EjecutarAcccionGralEnGrilla_Mens(a,b,c,e,d,f,g,l){var h=d.substring(5).split("|");qcom_Confirmar(h[1],"warning",function(){qgrillas_EjecutarAcccionGralEnGrilla(a,b,c,e,h[0],f,g,l)},function(){qevt_VaciarEventosTmp()})}
function qgrillas_EjecutarAccionFilaEliminada(a,b,c,e,d){$("#divCargando").addClass("show");var f=gGrillas[b].Tabla,g="",l= false;b=qcom_CargarTablasAEnviar(e,gEntidad);$.each(gRelacTablas,function(a,b){if("G"==b.getTipoCtrlDetalle()&&b.getTablaDetalle()==f)return l= true,g=b.getTablaMaster(), false});if(l){c=qgrillas_ArmarObjetoFilaFila("grd"+g);gEntidadAux[g].splice(0);gEntidadAux[g].push(c);var h=JSON.stringify(gEntidadAux);c=sessionStorage.getItem("idses");a={pDsEntidad:b,pDsEntidadAux:h,pIndice:-1,pDllEventos:gFormulario.getDLLEventos(),
pClaseEventos:gFormulario.getClaseEventos(),pDllCommon:gFormulario.getDLLCommon(),pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),pTieneDSEsp:gTieneDsEsp,pEsEspecializada:d,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,pNombreAccion:a,pFormulario:gConfiguracion.getFormulario(),pIdSes:c,pCodigoConsulta:""};$.ajax({type:"POST",
url:gConfiguracion.getSitio()+"AjaxHandler/AcGrillas.ashx?pTipoAccion=A",data:a,dataType:"json"}).done(function(a){$("#divCargando").removeClass("show");void 0==a.e?(h=a,$.each(gControles[g][0],function(a,b){null!=gControles[g][0][a]&&qcom_AsignarValorControl(gControles[g][0][a],h[g][0][a], false)}),qevt_EjecutarSiguiente()):qcom_TratarError(a.e)}).fail(function(a,b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_Alerta(c,"danger",null)})}else qevt_VaciarEventosTmp(),qcom_Alerta("Fila Eliminada con Acciones de FE, solo es posible con Grillas de segundo nivel",
"danger",null)}
function qgrillas_EliminarFila(a,b,c,e,d,f){$("#divCargando").addClass("show");var g=gGrillas[a].Tabla,l="",h= false,m= false;c=qcom_CargarTablasAEnviar(d,gEntidad);var n=null;$.each(gRelacTablas,function(a,b){if("G"==b.getTipoCtrlDetalle()){if(b.getTablaMaster()==g)return h= true, false;if(b.getTablaDetalle()==g)return m= true,l=b.getTablaMaster(), false}});e=-1;d=sessionStorage.getItem("idses");if(h||!h&&!m)b={pDsEntidad:c,pDllEventos:gFormulario.getDLLEventos(),pClaseEventos:gFormulario.getClaseEventos(),pDllCommon:gFormulario.getDLLCommon(),
pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),pTieneDSEsp:gTieneDsEsp,pEsEspecializada:f,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,pNombreCondicion:b,pFormulario:gConfiguracion.getFormulario(),pIdSes:d},$.ajax({type:"POST",url:gConfiguracion.getSitio()+"AjaxHandler/Condicion.ashx",data:b,dataType:"json"}).done(function(b){$("#divCargando").removeClass("show");
void 0==b.e?""!=lValorCond?(qevt_VaciarEventosTmp(),qcom_Alerta(lValorCond,"info",null)):($("#"+a).igGridUpdating("deleteRow",gGrillas[a].FilaaBorrar),qevt_EjecutarSiguiente()):qcom_TratarError(b.e)}).fail(function(a,b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_Alerta(c,"danger",null)});else if(m){gEntidadAux[l].splice(0);var n=qcom_Clonar(gEntidadAux),p=qgrillas_ArmarObjetoFilaFila("grd"+l);n[l].push(p);for(var p=n[g].length,q=0;q<p&&-1==e;q++)n[g][q].IDCol==gGrillas[a].ValorPK&&
(e=q);p=null==n?JSON.stringify(gEntidadAux):JSON.stringify(n);n=gConfiguracion.getSitio()+"AjaxHandler/AcGrillas.ashx?pTipoAccion=V";b={pDsEntidad:c,pDsEntidadAux:p,pIndice:e,pDllEventos:gFormulario.getDLLEventos(),pClaseEventos:gFormulario.getClaseEventos(),pDllCommon:gFormulario.getDLLCommon(),pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),
pTieneDSEsp:gTieneDsEsp,pEsEspecializada:f,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,pNombreAccion:b,pFormulario:gConfiguracion.getFormulario(),pIdSes:d};$.ajax({type:"POST",url:gConfiguracion.getSitio()+n,data:b,dataType:"json"}).done(function(b){$("#divCargando").removeClass("show");void 0==b.e?""!=b?(qevt_VaciarEventosTmp(),qcom_Alerta(b,"info",null)):($("#"+a).igGridUpdating("deleteRow",gGrillas[a].FilaaBorrar),gTieneSinGuardar= true,qevt_EjecutarSiguiente()):qcom_TratarError(b.e)}).fail(function(a,
b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_Alerta(c,"danger",null)})}}
function qgrillas_FiltrarGrilla(a,b){var c=gGrillas[a].Tabla,e="",d="";$.each(gRelacTablas,function(a,f){if("G"==f.getTipoCtrlDetalle()&&f.getTablaDetalle()==c&&b==f.getTablaMaster())return e=f.getColMaster(),d=f.getColDetalle(), false});var f="grd"+b;if(void 0!=gGrillas[f]){var g=$("#"+f).igGridSelection("selectedCell"),f=$("#"+f).igGrid("getCellValue",g.rowIndex,e);$("#"+a).igGridFiltering("filter",[{fieldName:d,expr:f,cond:"equals",logic:"AND"}])}qevt_EjecutarSiguiente()}
function qgrillas_CambiarModoEdicion(){$.each(gGrillas,function(a,b){b.Editable&&("phone"==b.Control.igGridResponsive("getCurrentResponsiveMode")?(b.Control.igGridUpdating("option","excelNavigationMode", false),b.Control.igGridUpdating("option","editMode","dialog")):(b.Control.igGridUpdating("option","editMode","cell"),b.Control.igGridUpdating("option","excelNavigationMode", false)))})}
var qgrillas_ObtenermascaraNumerica=function(a){if(a.startsWith("N")||a.startsWith("NM")){if("N"==a||"NM"==a)return"N"==a?"0":"#,##0";2==a.length?(a=a.charAt(1),a="###0."+"0000000000".slice(10-a)):(a=a.charAt(2),a="#,##0."+"0000000000".slice(10-a));return a}return"0.0000"},qgrillas_FormatearSegunTipoFila=function(a,b){if(void 0!=b){var c=qgrillas_ObtenermascaraNumerica(b.FormatoNumeroFila);return $.ig.formatter(a,"number",c)}return $.ig.formatter(a,"number","0.0000")};
function qgrillas_CrearGrilla(a,b,c){gTieneGrillasAutoForm= true;var e=lTieneFormatoPorFila= false;null!=$("#"+a).data("igGrid")&&($("#div"+a).is(":Visible")||(e=0==$("#"+a).igGrid("option","columns").length),$("#"+a).igGrid("destroy"));var d=gGrillas[a].RegistrosPorPagina,f=""!=gGrillas[a].ColumnasFijas.trim()?gGrillas[a].ColumnasFijas.replace(" ","").split(","):[],g=""!=gGrillas[a].ColumnasSoloLectura.trim()?gGrillas[a].ColumnasSoloLectura.replace(" ","").split(","):[],l=""!=gGrillas[a].ColumnasOcultas.trim()?
gGrillas[a].ColumnasOcultas.replace(" ","").split(","):[],h=[],m=[];m.push({name:"Selection",mode:"cell",multipleSelection: false,activation: true,cellSelectionChanged:function(a,b){console.log(b.cell.rowIndex+"- "+b.cell.rowId+" - "+b.cell.columnKey)}});m.push({name:"Resizing",deferredResizing: false,allowDoubleClickToResize: false});0<d&&(m.push({name:"Paging",type:"local",pageSize:d,recordCountKey:"recordCountKey",pageIndexUrlKey:"pageIndex",pageSizeUrlKey:"pageSize"}),null!=b&&0<b.length&&m.push({name:"Filtering",
type:"local"}));var n=[],d=[],p=[];if(null!=c&&0<c.length){for(var q=0;q<c.length;q++){var k=c[q].Columna,r=-1!=jQuery.inArray(c[q].Columna,l);k==gGrillas[a].ColFmtNumFila&&(lTieneFormatoPorFila= true);var w= false;if(c[q].Columna==gGrillas[a].ColFmtNumFila||"IDCol"==c[q].Columna||-1!=jQuery.inArray(c[q].Columna,g))w= true;var u="text",v=[],t="*",x=jQuery.inArray(c[q].Columna,f);-1!=x&&(p.push({columnKey:k,allowFixing: false,isFixed: true}),gGrillas[a].AnchoColFijas.length>x&&(t=gGrillas[a].AnchoColFijas[x]));switch(c[q].Tipo){case "int":u=
"number";v.push({dataMode:"int"});d.push({headerText:k,key:k,dataType:"number",width:t,columnCssClass:"alignCol-derecha",headerCssClass:"alignHeaderCol-derecha",hidden:r,format:"0"});w||h.push(k);break;case "number":u="number";v.push({dataMode:"double",maxDecimals:4,minDecimals:2});lTieneFormatoPorFila?d.push({headerText:k,key:k,dataType:"number",width:t,columnCssClass:"alignCol-derecha",headerCssClass:"alignHeaderCol-derecha",hidden:r,format:"0.0000",formatter:qgrillas_FormatearSegunTipoFila}):d.push({headerText:k,
key:k,dataType:"number",width:t,columnCssClass:"alignCol-derecha",headerCssClass:"alignHeaderCol-derecha",hidden:r,format:"0.0000"});w||h.push(k);break;case "date":u="datepicker";v.push({dateInputFormat:"dd/MM/yyyy",dateDisplayFormat:"dd/MM/yyyy",locale:"es",dataMode:"date"});d.push({headerText:k,key:k,dataType:"date",width:t,columnCssClass:"alignCol-izquierda",headerCssClass:"alignHeaderCol-izquierda",hidden:r,format:"dd/MM/yyyy"});break;case "bool":u="checkbox";d.push({headerText:k,key:k,width:t,
dataType:"bool",hidden:r});break;default:d.push({headerText:k,key:k,dataType:"string",width:t,columnCssClass:"alignCol-izquierda",headerCssClass:"alignHeaderCol-izquierda",hidden:r})}n.push({columnKey:k,readOnly:w,editorType:u,editorOptions:0<v.length?v[0]:null})}d.push({headerText:"IDCol",key:"IDCol",dataType:"number",hidden: true});gGrillas[a].Editable&&m.push({name:"Updating",enableAddRow: false,enableDeleteRow: false,startEditTriggers:["dblclick","enter"],showDoneCancelButtons: false,excelNavigationMode: true,
editMode:"cell",columnSettings:n});0==f.length?m.push({name:"Responsive",enableVerticalRendering: false,reactOnContainerWidthChanges: true}):m.push({name:"ColumnFixing",showFixButtons: false,columnSettings:p});f=gGrillasAutoFTotales[a].cant;g=gGrillasAutoFTotales[a].min;n=gGrillasAutoFTotales[a].max;p=gGrillasAutoFTotales[a].prom;r=gGrillasAutoFTotales[a].sum;if(""!=gGrillasAutoFTotales[a].cant+gGrillasAutoFTotales[a].min+gGrillasAutoFTotales[a].max+gGrillasAutoFTotales[a].prom+gGrillasAutoFTotales[a].sum){f=
gGrillasAutoFTotales[a].cant.split(",");g=gGrillasAutoFTotales[a].min.split(",");n=gGrillasAutoFTotales[a].max.split(",");p=gGrillasAutoFTotales[a].prom.split(",");r=gGrillasAutoFTotales[a].sum.split(",");w=[];for(q=0;q<c.length;q++){var k=c[q].Columna,u=c[q].Tipo,v=-1<f.indexOf(k)||-1<f.indexOf("*")&&("int"==u||"number"==u),t=-1<g.indexOf(k)||-1<g.indexOf("*")&&("int"==u||"number"==u),x=-1<n.indexOf(k)||-1<n.indexOf("*")&&("int"==u||"number"==u),z=-1<p.indexOf(k)||-1<p.indexOf("*")&&("int"==u||"number"==
u),A=-1<r.indexOf(k)||-1<r.indexOf("*")&&("int"==u||"number"==u),B=v||x||t||z||A,y=0;"number"==u&&(y=4);B?w.push({columnKey:k,allowSummaries: true,summaryOperands:[{type:"AVG",active:z,decimalDisplay:y},{type:"COUNT",active:v,decimalDisplay:y},{type:"MIN",active:t,decimalDisplay:y},{type:"MAX",active:x,decimalDisplay:y},{type:"SUM",active:A,decimalDisplay:y}]}):w.push({columnKey:k,allowSummaries: false})}m.push({name:"Summaries",columnSettings:w})}}e&&$("#div"+a).show();null!=c&&0<c.length?$("#"+a).igGrid({autoGenerateColumns: false,
autofitLastColumn: true,autoFormat: true,renderCheckboxes: true,disabled: false,dataSource:b,width:"100%",heigth:"81px",primaryKey:"IDCol",autoCommit: true,defaultColumnWidth:"*",columns:d,features:m,rendered:function(a,b){}}):$("#"+a).igGrid({autoGenerateColumns: true,autofitLastColumn: true,autoFormat: true,renderCheckboxes: true,disabled: false,dataSource:b,width:"100%",heigth:"81px",primaryKey:"IDCol",autoCommit: true,features:m,rendered:function(a,b){}});gGrillas[a].Editable&&($(document).delegate("#"+a,"iggridupdatingeditcellstarting",
function(b,c){gGrillas[a].ColumnasSoloLectura.replace(" ","").split(",");if(-1!=jQuery.inArray(c.columnKey,l))return false;var d=gGrillas[a].Tabla+"SoloLect";if(void 0!=gEntidad[d]&&gEntidad[d].length>=c.rowID&&1==gEntidad[d][c.rowID][c.columnKey])return false;if(lTieneFormatoPorFila){$("#"+a).igGrid("option","columns");var d=$("#"+a).igGrid("getCellValue",c.rowID,gGrillas[a].ColFmtNumFila),e=$("#"+a).igGrid("getCellValue",c.rowID,c.columnKey),f=$("#"+a).igGridUpdating("editorForKey",c.columnKey);"N"==d&&
"number"==jQuery.type(e)?f[0].onkeydown=qgrillas_AnuloTeclaPunto:f[0].onkeydown=null}}),$(document).delegate("#"+a,"iggridupdatingeditcellended",function(b,c){if("number"==jQuery.type(c.value)){var d=gGrillasAutoFTotales[a].col,e;""!=d&&-1!=jQuery.inArray(c.columnKey,h)&&(e=$("#"+a).igGrid("getCellValue",c.rowID,d),e=e-c.oldValue+c.value,$("#"+a).igGridUpdating("setCellValue",c.rowID,d,e))}return c.value}));e&&$("#div"+a).hide()}var qgrillas_AnuloTeclaPunto=function(a){if(190==a.keyCode)return false};
function qgrillas_EncontrarHijosNodo(a,b,c,e){var d=null,f=gGrillas[a].Control.igTreeGrid("option","primaryKey");if(e)for(e=0;e<b._data.length&&null==d;e++)b._data[e][f]==c?d=void 0!=b._data[e].childData?b._data[e].childData:void 0:void 0!=b._data[e].childData&&(d=qgrillas_EncontrarHijosNodo(a,b._data[e].childData,c, false));else for(e=0;e<b.length&&null==d;e++)b[e][f]==c?d=void 0!=b[e].childData?b[e].childData:void 0:void 0!=b[e].childData&&(d=qgrillas_EncontrarHijosNodo(a,b[e].childData,c, false));return d}
function qgrillas_ActualizarHijos(a,b,c,e){var d=gGrillas[a].Control,f=d.igTreeGrid("option","primaryKey");if(null!=b&&void 0!=b)for(var g=0;g<b.length;g++)d.igTreeGridUpdating("setCellValue",b[g][f],e,c),b[g][e]=c,qgrillas_ActualizarHijos(a,b[g].childData,c,e, false)}
function qgrillas_ColapsarArbol(a){for(var b=gGrillas[a].Control.data("igGrid").dataSource,c=gGrillas[a].ExpandirHastaNivel,e=gGrillas[a].Control.igTreeGrid("option","primaryKey"),d=0;d<b._data.length;d++)qgrillas_ColapsarHijos(a,b._data[d].childData,2,c),1>c&&gGrillas[a].Control.igTreeGrid("collapseRow",b._data[d][e])}
function qgrillas_ColapsarHijos(a,b,c,e){if(void 0!=b){gGrillas[a].Control.data("igGrid");for(var d=gGrillas[a].Control.igTreeGrid("option","primaryKey"),f=0;f<b.length;f++)qgrillas_ColapsarHijos(a,b[f].childData,c+1,e),c>e&&gGrillas[a].Control.igTreeGrid("collapseRow",b[f][d])}}function qgrillas_EditarCheckBoxenArbol(a,b){var c=gGrillas[a].Control,e=gGrillas[a].ValorPK;c.igTreeGridUpdating("isEditing")&&(c.igTreeGridUpdating("endEdit", true, true),c.igTreeGridUpdating("startEdit",e,b))}
function qgrillas_EjecutarItemMenuCtxt(a){qevt_AgregarEventoaTmp(a.srcElement.id+"_Click",null, true)}function qgrillas_AccionSobreMenuCtxt(a,b){for(var c= false,e=0;e<gGrillasAux.length&&!c;e++)for(var d=gGrillasAux[e],f=0;f<gGrillas[d].ItemsMenuCtxt.length&&!c;f++)gGrillas[d].ItemsMenuCtxt[f].id==a&&("H"==b?gGrillas[d].ItemsMenuCtxt[f].visible= false:"S"==b?gGrillas[d].ItemsMenuCtxt[f].visible= true:"E"==b?gGrillas[d].ItemsMenuCtxt[f].disabled= false:"D"==b&&(gGrillas[d].ItemsMenuCtxt[f].disabled= true),c= true)}
function qgrillas_AsignarValorMenuCtxt(a,b){for(var c= false,e=0;e<gGrillasAux.length&&!c;e++)for(var d=gGrillasAux[e],f=0;f<gGrillas[d].ItemsMenuCtxt.length&&!c;f++)gGrillas[d].ItemsMenuCtxt[f].id==a&&(gGrillas[d].ItemsMenuCtxt[f].title=b,c= true)}
function qgrillas_MostrarMenuCtxt(a,b,c){gGrillas[a].EsArbol?-1==b.colIndex?$("#"+a).igTreeGridSelection("selectCellById",b.rowIndex,b.colKey):$("#"+a).igTreeGridSelection("selectCell",b.rowIndex,b.colIndex):-1==b.colIndex?$("#"+a).igGridSelection("selectCellById",b.rowIndex,b.colKey):$("#"+a).igGridSelection("selectCell",b.rowIndex,b.colIndex);qgrillas_SeleccionarCelda(a,b.rowIndex,b.rowKey,b.colKey, true);qevt_AgregarEventoaTmp(a+"_AntesMenuContextual",null, false);b=new qevt_evento;b.Acciones.push(new qevt_accion("0",
"",null,""));b.Acciones.push(new qevt_accion("1","A",qgrillas_EvtMostrarMenuCtxt,null,[a,c]));gEventosTmp.push(b);qevt_EjecutarSiguiente()}function qgrillas_EvtMostrarMenuCtxt(a,b){basicContext.show(gGrillas[a].ItemsMenuCtxt,b);var c=qpopup_ZIndexObtener();$(".basicContextContainer").css("z-index",c);qevt_EjecutarSiguiente()}function qgrillas_RadioOpcionsVisibles(a,b){b?$("#divopc"+a).show():$("#divopc"+a).hide();qevt_EjecutarSiguiente()}
function qgrilla_AsignarTituloCol(a,b,c){var e=sessionStorage.getItem("idses"),d=gConfiguracion.getSitio();$.ajax({type:"POST",url:d+"AjaxHandler/ObtenerTraduccion.ashx",data:{pTexto:c,pIdSes:e},dataType:"json"}).done(function(c){if(void 0==c.e){c=c.d;for(var d=$("#"+a).igGrid("option","columns"),e= false,f=0;f<d.length&&!e;f++)d[f].key==b&&(d[f].headerText=c,e= true);$("#"+a).igGrid("option","columns",d)}else qcom_TratarError(c.e);qevt_EjecutarSiguiente()}).fail(function(a,b,c){qcom_Alerta(c,"danger",null);
qevt_EjecutarSiguiente()})}
function qgrilla_AsignarTitulo(a,b){var c=sessionStorage.getItem("idses"),e=gConfiguracion.getSitio();$.ajax({type:"POST",url:e+"AjaxHandler/ObtenerTraduccion.ashx",data:{pTexto:b,pIdSes:c},dataType:"json"}).done(function(b){if(void 0==b.e){b=b.d;var c=$("#lbl"+a)[0].innerHTML.split("<a ");1<c.length?$("#lbl"+a)[0].innerHTML=$("#lbl"+a)[0].innerHTML.replace(c[0]+"<a ",b+"  <a "):$("#lbl"+a)[0].innerHTML=$("#lbl"+a)[0].innerHTML.replace(c[0],b)}else qcom_TratarError(b.e);qevt_EjecutarSiguiente()}).fail(function(a,
b,c){qcom_Alerta(c,"danger",null);qevt_EjecutarSiguiente()})}
function qgrillas_VaciarGrilla(a){var b=gGrillas[a].Tabla;gGrillas[a].UltimaPK=0;gEntidad[b].splice(0,gEntidad[b].length);gEntidadAux[b].splice(0,gEntidadAux[b].length);gGrillas[a].AutoFormateable?qgrillas_CrearGrilla(gGrillas[a].NombreControl,gEntidad[b],null):gGrillas[a].EsArbol?(gGrillas[a].Control.igTreeGrid("option","dataSource",gEntidad[b]),gGrillas[a].Control.igTreeGrid("dataBind")):(gGrillas[a].Control.igGrid("option","dataSource",gEntidad[b]),gGrillas[a].Control.igGrid("dataBind"),gGrillas[a].Control.igGridSelection("clearSelection"),
gGrillas[a].ValorPK=-1,gGrillas[a].ColIdEnEdicion=-1,gGrillas[a].ColumnaEnEdicion="");$.each(gRelacTablas,function(a,e){"G"==e.getTipoCtrlDetalle()&&e.getTablaMaster()==b&&(lNombreGrillaDetail="grd"+e.getTablaDetalle(),void 0!=gGrillas[lNombreGrillaDetail]&&qgrillas_VaciarGrilla(lNombreGrillaDetail))})}
function qgrillas_EjecutarObtenerMascara(a,b,c,e,d){$("#divCargando").addClass("show");var f="";""!=c&&void 0!=gGrillas[c]&&(f=gGrillas[c].Tabla);var g="",l= false,h= false;e=qcom_CargarTablasAEnviar(e,gEntidad);var m=null,n=-1;if(""!=c&&void 0!=gGrillas[c]){$.each(gRelacTablas,function(a,b){if(b.getTablaMaster()==f)return l= true, false;if(b.getTablaDetalle()==f)return h= true,g=b.getTablaMaster(), false});var p=qgrillas_ArmarObjetoFilaFila(c);if(l||!l&&!h){gEntidadAux[f].splice(0);gEntidadAux[f].push(p);for(var q=gEntidad[f].length,
k=0;k<q&&-1==n;k++)gEntidad[f][k].IDCol==gGrillas[c].ValorPK&&(n=k)}else if(h){gEntidadAux[g].splice(0);m=qcom_Clonar(gEntidadAux);q=qgrillas_ArmarObjetoFilaFila("grd"+g);m[g].push(q);q=m[f].length;for(k=0;k<q&&-1==n;k++)m[f][k].IDCol==gGrillas[c].ValorPK&&(n=k);-1==n?m[f].push(p):m[f][n]=p}}c=null==m?JSON.stringify(gEntidadAux):JSON.stringify(m);m=sessionStorage.getItem("idses");b={pDsEntidad:e,pDsEntidadAux:c,pIndice:n,pDllEventos:gFormulario.getDLLEventos(),pClaseEventos:gFormulario.getClaseEventos(),
pDllCommon:gFormulario.getDLLCommon(),pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),pTieneDSEsp:gTieneDsEsp,pEsEspecializada:d,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,pNombreAccion:b,pFormulario:gConfiguracion.getFormulario(),pIdSes:m,pCodigoConsulta:""};$.ajax({type:"POST",url:gConfiguracion.getSitio()+"AjaxHandler/AcGrillas.ashx?pTipoAccion=MASC",
data:b,dataType:"json"}).done(function(b){$("#divCargando").removeClass("show");void 0==b.e?(qcom_RecrearMaskEditor("#"+a,b.d),qevt_EjecutarSiguiente()):qcom_TratarError(b.e)}).fail(function(a,b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_Alerta(c,"danger",null)})}
function qgrillas_EjecutarMostrarHTML(a,b,c,e,d){$("#divCargando").addClass("show");var f="";""!=b&&void 0!=gGrillas[b]&&(f=gGrillas[b].Tabla);var g="",l= false,h= false;c=qcom_CargarTablasAEnviar(c,gEntidad);var m=null,n=-1;if(""!=b&&void 0!=gGrillas[b]){$.each(gRelacTablas,function(a,b){if(b.getTablaMaster()==f)return l= true, false;if(b.getTablaDetalle()==f)return h= true,g=b.getTablaMaster(), false});var p=qgrillas_ArmarObjetoFilaFila(b);if(l||!l&&!h){gEntidadAux[f].splice(0);gEntidadAux[f].push(p);for(var q=gEntidad[f].length,
k=0;k<q&&-1==n;k++)gEntidad[f][k].IDCol==gGrillas[b].ValorPK&&(n=k)}else if(h){gEntidadAux[g].splice(0);m=qcom_Clonar(gEntidadAux);q=qgrillas_ArmarObjetoFilaFila("grd"+g);m[g].push(q);q=m[f].length;for(k=0;k<q&&-1==n;k++)m[f][k].IDCol==gGrillas[b].ValorPK&&(n=k);-1==n?m[f].push(p):m[f][n]=p}}b=null==m?JSON.stringify(gEntidadAux):JSON.stringify(m);m=sessionStorage.getItem("idses");a={pDsEntidad:c,pDsEntidadAux:b,pIndice:n,pDllEventos:gFormulario.getDLLEventos(),pClaseEventos:gFormulario.getClaseEventos(),
pDllCommon:gFormulario.getDLLCommon(),pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),pTieneDSEsp:gTieneDsEsp,pEsEspecializada:d,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,pNombreAccion:a,pFormulario:gConfiguracion.getFormulario(),pIdSes:m,pCodigoConsulta:""};$.ajax({type:"POST",url:gConfiguracion.getSitio()+"AjaxHandler/AcGrillas.ashx?pTipoAccion=HTM",
data:a,dataType:"json"}).done(function(a){$("#divCargando").removeClass("show");if(void 0==a.e){var b=window.open("","","location=yes, menubar=yes, toolbar=yes, width=100");b.document.open();b.document.write(a.d);e&&(b.onafterprint=window.close,b.print());qevt_EjecutarSiguiente()}else qcom_TratarError(a.e)}).fail(function(a,b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_Alerta(c,"danger",null)})}
function qgrillas_ObtenerOrden(a){var b="",c="";if(void 0!=$("#"+a).data("igGrid").dataSource.settings.sorting&&null!=$("#"+a).data("igGrid").dataSource.settings.sorting){a=$("#"+a).data("igGrid").dataSource.settings.sorting.expressions;for(var e=0;e<a.length;e++)b+=c+a[e].fieldName+";"+a[e].dir,c="@"}return b}
function qgrillas_ObtenerFiltros(a){var b="",c="";if(void 0!=$("#"+a).data("igGrid").dataSource.settings.filtering&&null!=$("#"+a).data("igGrid").dataSource.settings.filtering){a=$("#"+a).data("igGrid").dataSource.settings.filtering.expressions;for(var e=0;e<a.length;e++)b+=c+a[e].fieldName+";"+a[e].cond+";"+a[e].expr,c="@"}return b}function qgrillas_QuitarFiltros(a){$("#"+a).igGridFiltering("filter",[], true);qevt_EjecutarSiguiente()}
function qgrillas_FiltrarGrillaGeneral(a,b,c,e,d){var f="",g=-1,l="";""!=c&&void 0!=gGrillas[c]&&(f=gGrillas[c].Tabla);if(""!=f){if(gGrillas[c].EsArbol)for(var l=gEntidad[f].length,h=gGrillas[c].CamposPK,m=0;m<l&&-1==g;m++)gEntidad[f][m][h]==gGrillas[c].ValorPK&&(g=m);else for(l=gEntidad[f].length,m=0;m<l&&-1==g;m++)gEntidad[f][m].IDCol==gGrillas[c].ValorPK&&(g=m);l=gGrillas[c].ColumnaEnEdicion}""!=f&&-1>=g?(qevt_VaciarEventosTmp(),qcom_Alerta(qrecSinFilaSelec,"danger",null)):($("#divCargando").addClass("show"),
c=sessionStorage.getItem("idses"),a={pDsEntidad:qcom_CargarTablasAEnviar(e,gEntidad),pIndice:g,pDllEventos:gFormulario.getDLLEventos(),pClaseEventos:gFormulario.getClaseEventos(),pDllCommon:gFormulario.getDLLCommon(),pClaseCommon:gFormulario.getClaseCommon(),pDllEventosEsp:gFormulario.getDLLEventosEsp(),pClaseEventosEsp:gFormulario.getClaseEventosEsp(),pDllCommonEsp:gFormulario.getDLLCommonEsp(),pClaseCommonEsp:gFormulario.getClaseCommonEsp(),pTieneDSEsp:gTieneDsEsp,pEsEspecializada:d,pTieneTablaAutoFormateable:gTieneGrillasAutoForm,
pNombreAccion:a,pTablasPlanas:gTablasPlanas.join("|"),pFormulario:gConfiguracion.getFormulario(),pIdSes:c,pEsDownload: true,pColumna:l},$.ajax({type:"POST",url:gConfiguracion.getSitio()+"AjaxHandler/AcGrillas.ashx?pTipoAccion=FGR",data:a,dataType:"json"}).done(function(a){$("#divCargando").removeClass("show");if(void 0==a.e){var c=[];$.each(a.Filtros,function(a,b){c.push({fieldName:b.Columna,expr:b.Valor,cond:b.Operador,logic:b.OperadorLogico})});$("#"+b).igGridFiltering("filter",c);qevt_EjecutarSiguiente()}else qcom_TratarError(a.e)}).fail(function(a,
b,c){qevt_VaciarEventosTmp();$("#divCargando").removeClass("show");qcom_Alerta(c,"danger",null)}))};
